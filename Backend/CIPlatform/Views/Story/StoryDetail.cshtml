@using CIPlatform.Models
@model StoryDetailModel


<script>
        $(function () {

        var PlaceHolderElement = $('#PlaceHolderHere');
        $('button[data-toggle="ajax-modal"]').click(function (event) {

            var url = $(this).data('url');
            var decodeUrl = decodeURIComponent(url);
            $.get(decodeUrl).done(function (data) {
                PlaceHolderElement.html(data);
                PlaceHolderElement.find('.modal').modal('show');
            })
        })

        PlaceHolderElement.on('click', '[data-bs-save="modal"]', function (event) {

            var formData = new FormData($('#modalForm').get(0));
            var form = $(this).parents('.modal').find('form');
            var actionUrl = form.attr('action');
            $.ajax({
                url: "/Mission/" + actionUrl,
                type: "POST",
                data: formData,
                processData: false,
                contentType: false,
                dataType: "json",
                success: function (data) {
                    PlaceHolderElement.find('.modal').modal('hide');
                }

            })
            PlaceHolderElement.find('.modal').modal('hide');
        })

    })

    function suggestCoWorker(){
        var PlaceHolderElement = $('#PlaceHolderHere');
        console.log("Hello");
        var formData = new FormData($('#modalForm').get(0));
            var form = $(this).parents('.modal').find('form');
            var actionUrl = form.attr('action');
            $.ajax({
                url: "/Story/SuggestCoWorker",
                type: "POST",
                data: formData,
                processData: false,
                contentType: false,
                dataType: "json",
                success: function (data) {
                    PlaceHolderElement.find('.modal').modal('hide');
                }

            })
            PlaceHolderElement.find('.modal').modal('hide');
    }
</script>

<div class="container-lg">
    <div class="row">
        <div class="col-md-6 col-sm-12">
            <div class="ecommerce-gallery" data-mdb-zoom-effect="true" data-mdb-auto-height="true">
                <div class="row shadow-5">
                    <div class="col-12 mb-1">
                        <div class="lightbox">
                            <img src="~/assets/Gallery_6.png" alt="Gallery image 1"
                                 class="ecommerce-gallery-main-img active w-100" />
                        </div>
                    </div>

                    @foreach (var item in Model.storyImg)
                    {
                        <div class="col-2 mt-1" style="padding-left: 2px;padding-right: 2px;">
                            <img src="@Url.Content(item)" data-mdb-img="@Url.Content(item)"
                             alt="Gallery image 1" class="active w-100" />
                        </div>
                    }
                </div>
            </div>
        </div>
        <div class="col-md-6 col-sm-12 p-5 pt-3">
            <div class="row">
                <div class="float-start mt-3">
                    <img src="@Url.Content(Model.userImg)" width="80" height="80"
                         class="d-inline-block rounded-circle ms-2" alt="">
                    <br>
                    <small>@Model.userName</small>
                </div>

                <div class="d-flex flex-row-reverse" style="margin-top: -31px;">
                    <button type="button" class="btn btn-sm btn-outline-dark rounded-pill">
                        <i class="bi bi-eye"></i>
                        <span class="text-wrap">@Model.viewCount Views</span>
                    </button>

                </div>
            </div>

            <div class="mt-4">
                <p>
                    @Model.whyVolenteer
                </p>
            </div>


            <div class="row mt-5">
                <div class="col-lg-6 col-md-12 col-sm-12 mt-2">
                    <button type="button" data-toggle="ajax-modal" data-target="#SuggestWorker" class="btn btn-outline-dark rounded-pill w-100"
                            data-url="@Url.Action("SuggestCoWorker", "Story" , new {id = @Model.storyId})">
                        <i class="bi bi-person-plus-fill"></i>
                        <span class="text-wrap">Recommended to a Co-Worker</span>
                    </button>
                </div>
                <div class="col-lg-6 col-md-12 col-sm-12 mt-2">
                    <button type="button" onclick="return location.href=' @Url.Action("MisionDetail","Mission",new {id= @Model.missionId}) '" class="btn btn-outline-warning rounded-pill w-100">
                        <span class="text-wrap">Open Mission</span>
                        <i class="bi bi-arrow-right"></i>
                    </button>
                </div>
            </div>
        </div>

    </div>

    <div id="PlaceHolderHere"></div>
    <div class="mt-5">
        <p class="fs-4">@Model.storyTitle</p>
        <hr>
        <div class="mt-4">
            @Model.storyDetail
        </div>
    </div>

</div>